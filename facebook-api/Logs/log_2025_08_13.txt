2025-08-13 17:47:54,022 - INFO - === ZENDESK WEBHOOK REQUEST ===
2025-08-13 17:47:54,023 - INFO - Request method: POST
2025-08-13 17:47:54,023 - INFO - Request headers: {'Host': 'd7c0385db0d8.ngrok-free.app', 'User-Agent': 'rest-client/2.1.0 (linux x86_64) ruby/3.4.4p34', 'Content-Length': '1817', 'Accept': 'application/json', 'Accept-Encoding': 'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'Content-Type': 'application/json', 'X-Forwarded-For': '103.150.240.228', 'X-Forwarded-Host': 'd7c0385db0d8.ngrok-free.app', 'X-Forwarded-Proto': 'https'}
2025-08-13 17:47:54,023 - INFO - Zendesk webhook received for ticket: unknown
2025-08-13 17:47:54,023 - INFO - Request data: {'additional_attributes': {}, 'can_reply': True, 'channel': 'Channel::Api', 'contact_inbox': {'id': 5, 'contact_id': 7, 'inbox_id': 2, 'source_id': '22', 'created_at': '2025-08-13T09:40:33.242Z', 'updated_at': '2025-08-13T09:40:33.242Z', 'hmac_verified': False, 'pubsub_token': 'pqq4wgQZcALy6q1pzWTgo2DH'}, 'id': 5, 'inbox_id': 2, 'messages': [{'id': 31, 'content': 'reply đc\n', 'account_id': 2, 'inbox_id': 2, 'conversation_id': 5, 'message_type': 1, 'created_at': 1755080449, 'updated_at': '2025-08-13T10:20:49.948Z', 'private': False, 'status': 'failed', 'source_id': None, 'content_type': 'text', 'content_attributes': {'external_error': '502 Bad Gateway'}, 'sender_type': 'User', 'sender_id': 2, 'external_source_ids': {}, 'additional_attributes': {}, 'processed_message_content': 'reply đc\n', 'sentiment': {}, 'conversation': {'assignee_id': 2, 'unread_count': 0, 'last_activity_at': 1755082035, 'contact_inbox': {'source_id': '22'}}, 'sender': {'id': 2, 'name': 'Support', 'available_name': 'Support', 'avatar_url': '', 'type': 'user', 'availability_status': None, 'thumbnail': ''}}], 'labels': [], 'meta': {'sender': {'additional_attributes': {}, 'custom_attributes': {}, 'email': None, 'id': 7, 'identifier': 'zendesk:13471370130831:22', 'name': 'Anh Nguyen', 'phone_number': None, 'thumbnail': '', 'blocked': False, 'type': 'contact'}, 'assignee': {'id': 2, 'name': 'Support', 'available_name': 'Support', 'avatar_url': '', 'type': 'user', 'availability_status': None, 'thumbnail': ''}, 'team': None, 'hmac_verified': False}, 'status': 'resolved', 'custom_attributes': {'ticket_id': '22'}, 'snoozed_until': None, 'unread_count': 0, 'first_reply_created_at': '2025-08-13T09:41:54.825Z', 'priority': None, 'waiting_since': 0, 'agent_last_seen_at': 1755082054, 'contact_last_seen_at': 0, 'last_activity_at': 1755082035, 'timestamp': 1755082035, 'created_at': 1755078033, 'updated_at': 1755082073.921052, 'event': 'conversation_status_changed', 'changed_attributes': None}
2025-08-13 17:47:54,024 - INFO - === BACKGROUND PROCESSING ZENDESK WEBHOOK ===
2025-08-13 17:47:54,024 - INFO - Started background thread for Zendesk ticket unknown
2025-08-13 17:47:54,024 - INFO - Processing Zendesk webhook
2025-08-13 17:47:54,024 - INFO - Zendesk webhook response: {'status': 'success', 'message': 'Zendesk webhook received and queued for processing', 'timestamp': '2025-08-13T17:47:54.023484', 'processing': 'async', 'ticket_id': 'unknown', 'will_sync_to_chatwoot': True}
2025-08-13 17:47:54,025 - INFO - Zendesk webhook data: {
  "additional_attributes": {},
  "can_reply": true,
  "channel": "Channel::Api",
  "contact_inbox": {
    "id": 5,
    "contact_id": 7,
    "inbox_id": 2,
    "source_id": "22",
    "created_at": "2025-08-13T09:40:33.242Z",
    "updated_at": "2025-08-13T09:40:33.242Z",
    "hmac_verified": false,
    "pubsub_token": "pqq4wgQZcALy6q1pzWTgo2DH"
  },
  "id": 5,
  "inbox_id": 2,
  "messages": [
    {
      "id": 31,
      "content": "reply đc\n",
      "account_id": 2,
      "inbox_id": 2,
      "conversation_id": 5,
      "message_type": 1,
      "created_at": 1755080449,
      "updated_at": "2025-08-13T10:20:49.948Z",
      "private": false,
      "status": "failed",
      "source_id": null,
      "content_type": "text",
      "content_attributes": {
        "external_error": "502 Bad Gateway"
      },
      "sender_type": "User",
      "sender_id": 2,
      "external_source_ids": {},
      "additional_attributes": {},
      "processed_message_content": "reply đc\n",
      "sentiment": {},
      "conversation": {
        "assignee_id": 2,
        "unread_count": 0,
        "last_activity_at": 1755082035,
        "contact_inbox": {
          "source_id": "22"
        }
      },
      "sender": {
        "id": 2,
        "name": "Support",
        "available_name": "Support",
        "avatar_url": "",
        "type": "user",
        "availability_status": null,
        "thumbnail": ""
      }
    }
  ],
  "labels": [],
  "meta": {
    "sender": {
      "additional_attributes": {},
      "custom_attributes": {},
      "email": null,
      "id": 7,
      "identifier": "zendesk:13471370130831:22",
      "name": "Anh Nguyen",
      "phone_number": null,
      "thumbnail": "",
      "blocked": false,
      "type": "contact"
    },
    "assignee": {
      "id": 2,
      "name": "Support",
      "available_name": "Support",
      "avatar_url": "",
      "type": "user",
      "availability_status": null,
      "thumbnail": ""
    },
    "team": null,
    "hmac_verified": false
  },
  "status": "resolved",
  "custom_attributes": {
    "ticket_id": "22"
  },
  "snoozed_until": null,
  "unread_count": 0,
  "first_reply_created_at": "2025-08-13T09:41:54.825Z",
  "priority": null,
  "waiting_since": 0,
  "agent_last_seen_at": 1755082054,
  "contact_last_seen_at": 0,
  "last_activity_at": 1755082035,
  "timestamp": 1755082035,
  "created_at": 1755078033,
  "updated_at": 1755082073.921052,
  "event": "conversation_status_changed",
  "changed_attributes": null
}
2025-08-13 17:47:54,025 - INFO - 127.0.0.1 - - [13/Aug/2025 17:47:54] "POST /service-api-webhook/zendesk-webhook HTTP/1.1" 200 -
2025-08-13 17:47:54,026 - WARNING - Missing ticket_id or comment in Zendesk webhook
2025-08-13 17:47:54,297 - INFO - === ZENDESK WEBHOOK REQUEST ===
2025-08-13 17:47:54,297 - INFO - Request method: POST
2025-08-13 17:47:54,298 - INFO - Request headers: {'Host': 'd7c0385db0d8.ngrok-free.app', 'User-Agent': 'rest-client/2.1.0 (linux x86_64) ruby/3.4.4p34', 'Content-Length': '1975', 'Accept': 'application/json', 'Accept-Encoding': 'gzip;q=1.0,deflate;q=0.6,identity;q=0.3', 'Content-Type': 'application/json', 'X-Forwarded-For': '103.150.240.228', 'X-Forwarded-Host': 'd7c0385db0d8.ngrok-free.app', 'X-Forwarded-Proto': 'https'}
2025-08-13 17:47:54,299 - INFO - Zendesk webhook received for ticket: unknown
2025-08-13 17:47:54,299 - INFO - Request data: {'additional_attributes': {}, 'can_reply': True, 'channel': 'Channel::Api', 'contact_inbox': {'id': 5, 'contact_id': 7, 'inbox_id': 2, 'source_id': '22', 'created_at': '2025-08-13T09:40:33.242Z', 'updated_at': '2025-08-13T09:40:33.242Z', 'hmac_verified': False, 'pubsub_token': 'pqq4wgQZcALy6q1pzWTgo2DH'}, 'id': 5, 'inbox_id': 2, 'messages': [{'id': 31, 'content': 'reply đc\n', 'account_id': 2, 'inbox_id': 2, 'conversation_id': 5, 'message_type': 1, 'created_at': 1755080449, 'updated_at': '2025-08-13T10:20:49.948Z', 'private': False, 'status': 'failed', 'source_id': None, 'content_type': 'text', 'content_attributes': {'external_error': '502 Bad Gateway'}, 'sender_type': 'User', 'sender_id': 2, 'external_source_ids': {}, 'additional_attributes': {}, 'processed_message_content': 'reply đc\n', 'sentiment': {}, 'conversation': {'assignee_id': 2, 'unread_count': 0, 'last_activity_at': 1755082035, 'contact_inbox': {'source_id': '22'}}, 'sender': {'id': 2, 'name': 'Support', 'available_name': 'Support', 'avatar_url': '', 'type': 'user', 'availability_status': None, 'thumbnail': ''}}], 'labels': [], 'meta': {'sender': {'additional_attributes': {}, 'custom_attributes': {}, 'email': None, 'id': 7, 'identifier': 'zendesk:13471370130831:22', 'name': 'Anh Nguyen', 'phone_number': None, 'thumbnail': '', 'blocked': False, 'type': 'contact'}, 'assignee': {'id': 2, 'name': 'Support', 'available_name': 'Support', 'avatar_url': '', 'type': 'user', 'availability_status': None, 'thumbnail': ''}, 'team': None, 'hmac_verified': False}, 'status': 'resolved', 'custom_attributes': {'ticket_id': '22'}, 'snoozed_until': None, 'unread_count': 0, 'first_reply_created_at': '2025-08-13T09:41:54.825Z', 'priority': None, 'waiting_since': 0, 'agent_last_seen_at': 1755082054, 'contact_last_seen_at': 0, 'last_activity_at': 1755082035, 'timestamp': 1755082035, 'created_at': 1755078033, 'updated_at': 1755082073.921052, 'event': 'conversation_updated', 'changed_attributes': [{'status': {'previous_value': 'open', 'current_value': 'resolved'}}, {'updated_at': {'previous_value': '2025-08-13T10:47:15.825Z', 'current_value': '2025-08-13T10:47:53.921Z'}}]}
2025-08-13 17:47:54,300 - INFO - === BACKGROUND PROCESSING ZENDESK WEBHOOK ===
2025-08-13 17:47:54,301 - INFO - Started background thread for Zendesk ticket unknown
2025-08-13 17:47:54,301 - INFO - Processing Zendesk webhook
2025-08-13 17:47:54,301 - INFO - Zendesk webhook response: {'status': 'success', 'message': 'Zendesk webhook received and queued for processing', 'timestamp': '2025-08-13T17:47:54.298754', 'processing': 'async', 'ticket_id': 'unknown', 'will_sync_to_chatwoot': True}
2025-08-13 17:47:54,301 - INFO - Zendesk webhook data: {
  "additional_attributes": {},
  "can_reply": true,
  "channel": "Channel::Api",
  "contact_inbox": {
    "id": 5,
    "contact_id": 7,
    "inbox_id": 2,
    "source_id": "22",
    "created_at": "2025-08-13T09:40:33.242Z",
    "updated_at": "2025-08-13T09:40:33.242Z",
    "hmac_verified": false,
    "pubsub_token": "pqq4wgQZcALy6q1pzWTgo2DH"
  },
  "id": 5,
  "inbox_id": 2,
  "messages": [
    {
      "id": 31,
      "content": "reply đc\n",
      "account_id": 2,
      "inbox_id": 2,
      "conversation_id": 5,
      "message_type": 1,
      "created_at": 1755080449,
      "updated_at": "2025-08-13T10:20:49.948Z",
      "private": false,
      "status": "failed",
      "source_id": null,
      "content_type": "text",
      "content_attributes": {
        "external_error": "502 Bad Gateway"
      },
      "sender_type": "User",
      "sender_id": 2,
      "external_source_ids": {},
      "additional_attributes": {},
      "processed_message_content": "reply đc\n",
      "sentiment": {},
      "conversation": {
        "assignee_id": 2,
        "unread_count": 0,
        "last_activity_at": 1755082035,
        "contact_inbox": {
          "source_id": "22"
        }
      },
      "sender": {
        "id": 2,
        "name": "Support",
        "available_name": "Support",
        "avatar_url": "",
        "type": "user",
        "availability_status": null,
        "thumbnail": ""
      }
    }
  ],
  "labels": [],
  "meta": {
    "sender": {
      "additional_attributes": {},
      "custom_attributes": {},
      "email": null,
      "id": 7,
      "identifier": "zendesk:13471370130831:22",
      "name": "Anh Nguyen",
      "phone_number": null,
      "thumbnail": "",
      "blocked": false,
      "type": "contact"
    },
    "assignee": {
      "id": 2,
      "name": "Support",
      "available_name": "Support",
      "avatar_url": "",
      "type": "user",
      "availability_status": null,
      "thumbnail": ""
    },
    "team": null,
    "hmac_verified": false
  },
  "status": "resolved",
  "custom_attributes": {
    "ticket_id": "22"
  },
  "snoozed_until": null,
  "unread_count": 0,
  "first_reply_created_at": "2025-08-13T09:41:54.825Z",
  "priority": null,
  "waiting_since": 0,
  "agent_last_seen_at": 1755082054,
  "contact_last_seen_at": 0,
  "last_activity_at": 1755082035,
  "timestamp": 1755082035,
  "created_at": 1755078033,
  "updated_at": 1755082073.921052,
  "event": "conversation_updated",
  "changed_attributes": [
    {
      "status": {
        "previous_value": "open",
        "current_value": "resolved"
      }
    },
    {
      "updated_at": {
        "previous_value": "2025-08-13T10:47:15.825Z",
        "current_value": "2025-08-13T10:47:53.921Z"
      }
    }
  ]
}
2025-08-13 17:47:54,302 - INFO - 127.0.0.1 - - [13/Aug/2025 17:47:54] "POST /service-api-webhook/zendesk-webhook HTTP/1.1" 200 -
2025-08-13 17:47:54,303 - WARNING - Missing ticket_id or comment in Zendesk webhook
